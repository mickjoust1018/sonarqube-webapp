# Vue版本功能完善计划

## 当前状态总结

### ✅ 已完成的核心功能（约70%）

1. **问题管理** - 基础功能完整
   - ✅ 问题列表和筛选
   - ✅ 问题详情侧边栏（评论、历史、操作）
   - ✅ 批量操作
   - ⚠️ 需要增强：问题流、代码上下文、规则详情

2. **项目概览** - 基础实现完成
   - ✅ 度量指标展示
   - ✅ 图表（问题趋势、覆盖率）
   - ✅ 质量门状态
   - ⚠️ 需要增强：分支概览、更多图表类型

3. **项目创建** - 功能完整
   - ✅ 手动创建（完整验证）
   - ✅ ALM集成（占位实现）

4. **管理功能** - 路由和页面结构完整
   - ✅ 所有管理页面的路由已配置
   - ⚠️ 大部分页面需要实现具体功能

### ❌ 关键缺失功能

1. **代码查看器** - 功能不完整（优先级：高）
   - ❌ 文件树导航
   - ❌ 代码度量显示
   - ❌ 行号跳转
   - ❌ 问题标记
   - ❌ 代码搜索
   - ❌ 分支切换

2. **分支管理** - 完全缺失（优先级：高）
   - ❌ 分支列表
   - ❌ 分支创建/删除
   - ❌ 分支切换
   - ❌ 分支分析历史

3. **问题管理增强** - 部分缺失（优先级：中）
   - ❌ 问题流显示
   - ❌ 代码上下文
   - ❌ 规则详情展示
   - ❌ 问题标签管理

## 完善计划

### 阶段一：核心功能完善（高优先级）

#### 1.1 代码查看器完善
**目标**: 实现完整的代码查看功能

**需要实现的功能**:
- [ ] 文件树组件（左侧导航）
- [ ] 代码行号显示
- [ ] 代码高亮（已部分实现）
- [ ] 问题标记（行号旁显示问题图标）
- [ ] 代码度量显示（覆盖率、复杂度等）
- [ ] 行号跳转功能
- [ ] 代码搜索功能
- [ ] 分支切换下拉
- [ ] 键盘导航支持
- [ ] 预览模式（Markdown等）

**参考实现**: `libs/sq-server-commons/src/components/SourceViewer/`

#### 1.2 分支管理
**目标**: 实现项目分支管理功能

**需要实现的功能**:
- [ ] 分支列表页面 (`/project/:projectKey/branches`)
- [ ] 分支创建表单
- [ ] 分支删除确认
- [ ] 分支设置（排除、自动删除等）
- [ ] 分支分析历史
- [ ] 分支切换功能

**参考实现**: `apps/sq-server/src/main/js/apps/overview/branches/`

#### 1.3 问题管理增强
**目标**: 增强问题管理的代码上下文功能

**需要实现的功能**:
- [ ] 问题流（flows）可视化
- [ ] 问题位置导航
- [ ] 代码上下文显示（在代码查看器中高亮问题行）
- [ ] 规则详情弹窗
- [ ] 问题标签管理
- [ ] 问题过滤器保存

### 阶段二：功能增强（中优先级）

#### 2.1 项目概览增强
- [ ] 分支概览页面
- [ ] 更多图表类型（饼图、面积图等）
- [ ] 时间范围选择器
- [ ] 度量对比功能
- [ ] 新代码定义显示

#### 2.2 组合/投资组合管理
- [ ] 组合列表页面 (`/portfolios`)
- [ ] 组合创建表单
- [ ] 组合编辑
- [ ] 组合视图

### 阶段三：高级功能（低优先级）

#### 3.1 架构分析（需要Feature.Architecture）
- [ ] 组件依赖图
- [ ] 架构规则

#### 3.2 SCA功能（需要Feature.Sca）
- [ ] 依赖分析
- [ ] 漏洞扫描

#### 3.3 SonarLint集成
- [ ] SonarLint认证页面
- [ ] IDE连接管理

## 具体实现建议

### 代码查看器实现步骤

1. **创建文件树组件**
   ```vue
   <FileTree
     :components="components"
     :selected="selectedComponent"
     @select="handleSelect"
   />
   ```

2. **创建代码行组件**
   ```vue
   <SourceLine
     :line="line"
     :issues="issues"
     :measures="measures"
     :highlighted="highlighted"
   />
   ```

3. **集成代码高亮**
   - 使用 highlight.js（已集成）
   - 支持多种语言
   - 行号显示

4. **添加问题标记**
   - 在行号旁显示问题图标
   - 点击显示问题详情
   - 不同严重程度不同颜色

5. **添加代码度量**
   - 覆盖率显示
   - 复杂度显示
   - 重复代码标记

### 分支管理实现步骤

1. **创建分支列表API**
   ```typescript
   export function getBranches(project: string): Promise<Branch[]>
   export function createBranch(data: { project: string; name: string }): Promise<Branch>
   export function deleteBranch(data: { project: string; branch: string }): Promise<void>
   ```

2. **创建分支列表页面**
   - 显示所有分支
   - 分支状态（主分支、分析日期等）
   - 操作按钮（删除、设置）

3. **创建分支创建表单**
   - 分支名称输入
   - 验证规则
   - 提交处理

4. **添加分支切换功能**
   - 在项目页面添加分支选择器
   - 切换分支时更新URL和重新加载数据

## Mock数据扩展

需要为以下功能添加Mock数据：

1. **代码查看器**
   - 文件树数据
   - 源代码数据
   - 代码度量数据

2. **分支管理**
   - 分支列表数据
   - 分支分析历史

3. **问题流**
   - 问题流数据
   - 位置数据

## 测试建议

1. **单元测试**
   - 代码查看器组件
   - 分支管理组件
   - 问题流组件

2. **集成测试**
   - 代码查看器与问题管理的集成
   - 分支切换功能
   - 问题导航功能

3. **E2E测试**
   - 完整的代码查看流程
   - 分支管理流程
   - 问题处理流程

## 时间估算

- **阶段一**（核心功能完善）: 2-3周
- **阶段二**（功能增强）: 1-2周
- **阶段三**（高级功能）: 根据需求决定

## 总结

Vue版本已经实现了约70%的核心功能，主要缺失的是：
1. 代码查看器的完整功能
2. 分支管理功能
3. 问题管理的高级功能

建议优先完善代码查看器和分支管理，这两个是用户最常用的核心功能。
